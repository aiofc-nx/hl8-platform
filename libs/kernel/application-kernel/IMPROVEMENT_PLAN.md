# Application Kernel 改进计划

基于 `specs/002-application-kernel` 规格文档和当前代码状态制定的改进计划。

## 📋 改进概览

### 已完成 ✅

- Phase 1-12: 核心功能实现完成（129/140 任务）
- 所有 P1 用户故事（US1-US6）已实现
- 所有 P2 用户故事（US7-US8）已实现
- 基础架构（异常、配置）已完成
- 集成测试已创建

### 待完成 ⚠️

- Phase 13: 文档和收尾（T131-T140，10 个任务）
- T040: 用例集成测试
- 模块导出状态明确
- TODO 标记清理

---

## 🎯 改进任务清单

### 优先级 1: 模块导出和状态明确

#### 1.1 检查和启用项目器（Projectors）导出

- [ ] 检查 `src/projectors/index.ts` 导出状态
- [ ] 确认项目器实现完整性
- [ ] 如果完成，启用导出
- [ ] 更新文档说明项目器状态

#### 1.2 检查和启用 Saga 导出

- [ ] 检查 `src/sagas/index.ts` 导出状态
- [ ] 确认 Saga 实现完整性（检查 TODO）
- [ ] 如果完成，启用导出
- [ ] 更新文档说明 Saga 状态

#### 1.3 检查和启用 Bus 导出

- [ ] 检查 `src/bus/index.ts` 导出状态
- [ ] 确认 Bus 实现完整性
- [ ] 如果完成，启用导出
- [ ] 更新文档说明 Bus 状态

#### 1.4 完善事件总线导出

- [ ] 检查 `src/events/index.ts` 中事件总线的导出状态
- [ ] 确认 EventBus 接口和实现完整性
- [ ] 如果完成，启用导出

#### 1.5 完善缓存模块导出

- [ ] 检查缓存模块的导出状态
- [ ] 确认所有缓存功能是否应导出

---

### 优先级 2: 完善实现（修复 TODO）

#### 2.1 Saga 恢复逻辑

- [ ] 实现 `saga-error-handler.ts` 中的恢复逻辑
- [ ] 实现重试机制（立即重试、延迟重试、指数退避）
- [ ] 实现跳过步骤逻辑
- [ ] 实现管理员通知

#### 2.2 Saga 执行引擎

- [ ] 实现事件收集
- [ ] 实现 Saga 恢复逻辑
- [ ] 完善执行计数恢复

#### 2.3 Saga 补偿管理器

- [ ] 实现 Saga 实例创建逻辑

#### 2.4 Saga 状态持久化

- [ ] 实现文件系统持久化（如果需要）

#### 2.5 缓存功能

- [ ] 实现缓存命中率统计

---

### 优先级 3: 文档完善（Phase 13）

#### 3.1 API 文档（T131）

- [ ] 创建完整的 API 参考文档
- [ ] 包含所有公共类和接口的详细说明
- [ ] 提供参数、返回值、异常说明

#### 3.2 快速入门指南（T133）

- [ ] 创建开发者快速入门指南
- [ ] 提供完整的使用示例
- [ ] 覆盖所有主要功能模块

#### 3.3 代码示例（T134）

- [ ] 为每个模块创建示例代码
- [ ] 创建端到端使用示例
- [ ] 提供最佳实践示例

#### 3.4 其他文档

- [ ] 故障排除指南（T135）
- [ ] 性能调优指南（T136）
- [ ] 迁移指南（T137）
- [ ] 安全考虑文档（T138）
- [ ] 部署和配置指南（T139）

---

### 优先级 4: 测试完善

#### 4.1 用例集成测试（T040）

- [ ] 创建用例集成测试
- [ ] 测试用例与命令、查询、事件的集成
- [ ] 测试完整的用例执行流程

---

### 优先级 5: 代码清理（T140）

#### 5.1 最终代码审查

- [ ] 清理所有 TODO 标记（完成或标记为已知限制）
- [ ] 统一代码风格
- [ ] 优化性能
- [ ] 检查并修复潜在问题

---

## 🚀 执行计划

### 阶段 1: 模块状态明确（高优先级）

1. 检查各模块实现完整性
2. 确定哪些模块已完成可导出
3. 更新导出和文档

### 阶段 2: 完善实现（中优先级）

1. 修复 Saga 相关 TODO
2. 完善缓存功能
3. 代码清理

### 阶段 3: 文档完善（中优先级）

1. 创建快速入门指南
2. 完善 API 文档
3. 创建示例代码

### 阶段 4: 测试完善（低优先级）

1. 完成用例集成测试
2. 验证所有成功标准

---

## 📊 当前状态总结

### 模块状态

| 模块 | 实现状态 | 导出状态 | 备注 |
|------|---------|---------|------|
| Use Cases | ✅ 完成 | ✅ 已导出 | - |
| Commands | ✅ 完成 | ✅ 已导出 | - |
| Queries | ✅ 完成 | ✅ 已导出 | - |
| Events (Store) | ✅ 完成 | ✅ 已导出 | - |
| Events (Bus) | ✅ 完成 | ⚠️ 未导出 | 接口和实现存在 |
| Projectors | ✅ 完成 | ⚠️ 未导出 | 实现完整 |
| Sagas | ⚠️ 部分完成 | ⚠️ 未导出 | 有 TODO |
| Bus | ✅ 完成 | ⚠️ 未导出 | 在 module 中使用 |
| Cache | ✅ 完成 | ⚠️ 部分导出 | 部分功能未导出 |
| Monitoring | ✅ 完成 | ✅ 已导出 | - |
| Config | ✅ 完成 | ✅ 已导出 | - |
| Exceptions | ✅ 完成 | ✅ 已导出 | - |

### 测试状态

- ✅ 单元测试：36 个测试套件
- ✅ 集成测试：6 个测试套件
- ⚠️ 用例集成测试：缺失（T040）
- ✅ 契约测试：1 个测试套件

### 文档状态

- ✅ 基础文档：README.md 完整
- ⚠️ 开发指引：缺失（T133）
- ⚠️ API 文档：不完整（T131）
- ⚠️ 代码示例：缺失（T134）
- ⚠️ 其他文档：缺失（T135-T139）

---

## 📝 实施步骤

按照优先级逐步实施改进，确保每个阶段都经过充分测试和验证。
